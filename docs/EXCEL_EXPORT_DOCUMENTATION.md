# 📊 Excel Export Documentation

This document provides comprehensive details about the Excel files generated by the Transaction Analysis Tool, including
the structure, content, and purpose of each sheet.

## 📁 Generated Excel Files

The system generates two types of Excel reports:

1. **Comprehensive Analysis Report** (`*_analysis.xlsx`) - Multi-sheet detailed analysis
2. **Simple Report** (`*_simple.xlsx`) - Streamlined executive summary

---

## 🗂️ Comprehensive Analysis Report Structure

### 📋 Sheet Overview

The comprehensive Excel report contains multiple sheets, each focusing on specific aspects of the transaction analysis:

| Sheet Name                 | Purpose                      | Content Type                |
|----------------------------|------------------------------|-----------------------------|
| `Raw_Data`                 | Complete transaction dataset | Raw data with processing    |
| `Executive_Summary`        | High-level KPIs              | Key metrics table           |
| `Account_Analysis`         | Per-account breakdown        | Account-level analytics     |
| `Top_Merchants`            | Merchant frequency analysis  | Vendor/merchant insights    |
| `Category_Analysis`        | Transaction categorization   | Category performance        |
| `Active_Inactive_Accounts` | Account status analysis      | Account activity assessment |

---

## 📊 Detailed Sheet Descriptions

### 1️⃣ **Raw_Data Sheet**

**Purpose**: Contains the complete processed transaction dataset with all enhancements

**Columns Include**:

- `account_number` - Account identifier
- `transaction_date` - Transaction date (YYYY-MM-DD format)
- `main_description` - Primary transaction description
- `additional_description` - Secondary description (if available)
- `transaction_type` - Transaction type classification
- `amount` - Transaction amount (Decimal precision, 2 decimal places)
- `balance` - Running account balance (if available)
- `currency` - Transaction currency
- `auto_category` - AI-generated transaction category
- `category_confidence` - Categorization confidence score (0.0-1.0)

**Key Features**:

- ✅ **Decimal Precision**: All amounts use precise decimal arithmetic
- ✅ **Auto-Categorization**: Includes AI-generated categories when enabled
- ✅ **Large Dataset Support**: Automatically splits into multiple sheets if >1M rows
- ✅ **Clean Formatting**: Dates formatted consistently, amounts rounded to 2 decimal places

**Note**: For datasets exceeding 1M rows, additional sheets (`Raw_Data_2`, `Raw_Data_3`, etc.) are created
automatically.

---

### 2️⃣ **Executive_Summary Sheet**

**Purpose**: High-level key performance indicators and dataset overview

**Structure**: Two-column format (Metric | Value)

**Metrics Include**:

#### 📈 **Dataset Overview**

- `Analysis Date` - When the analysis was performed
- `Total Records Analyzed` - Number of transactions processed
- `Unique Accounts` - Number of distinct accounts
- `Unique Merchants` - Number of distinct vendors/payees
- `Date Range (Days)` - Span of transaction dates

#### 💰 **Financial Summary**

- `Total Credits` - Sum of all positive transactions (formatted as £X,XXX.XX)
- `Total Debits` - Sum of all negative transactions (formatted as £X,XXX.XX)
- `Net Position` - Overall financial position (Credits + Debits)

**Example**:

```
Metric                    | Value
--------------------------|------------------
Analysis Date             | 2025-01-15 14:30:22
Total Records Analyzed    | 1,872
Unique Accounts           | 2
Unique Merchants          | 822
Date Range (Days)         | 194
Total Credits             | £89,245.67
Total Debits              | £24,419.86
Net Position              | £64,825.81
```

---

### 3️⃣ **Account_Analysis Sheet**

**Purpose**: Individual account performance metrics and activity status

**Columns**:

- `account_number` - Account identifier
- `transaction_count` - Total transactions for this account
- `total_credits` - Sum of positive transactions (Decimal precision)
- `total_debits` - Sum of negative transactions (Decimal precision)
- `net_position` - Account net position
- `avg_transaction` - Average transaction amount
- `current_balance` - Latest account balance (if available)
- `days_since_last_transaction` - Days since last activity
- `is_active` - Account activity status (True/False)
- `reference_date_used` - Whether analysis used current date or data end date
- `is_historical_data` - Whether data is considered historical (>30 days old)
- `transactions_last_30_days` - Recent activity count

**Key Features**:

- ✅ **Smart Date Reference**: Uses appropriate reference date for historical vs current data
- ✅ **Activity Classification**: Intelligent active/inactive determination
- ✅ **Financial Metrics**: Complete financial summary per account
- ✅ **Decimal Precision**: All monetary values maintain precision

---

### 4️⃣ **Top_Merchants Sheet**

**Purpose**: Analysis of most frequent transaction counterparties

**Columns**:

- `Merchant` - Merchant/vendor name (cleaned and standardized)
- `Transaction_Count` - Number of transactions with this merchant

**Features**:

- ✅ **Frequency-Based**: Sorted by transaction count (descending)
- ✅ **Clean Names**: Merchant names processed to remove noise
- ✅ **Configurable Limit**: Shows top N merchants (default: 15)
- ✅ **Business Insights**: Identifies key vendors and revenue sources

**Use Cases**:

- Vendor relationship analysis
- Spend concentration assessment
- Revenue source identification
- Procurement insights

---

### 5️⃣ **Category_Analysis Sheet**

**Purpose**: Performance analysis by auto-generated transaction categories

**Columns**:

- `category` - Auto-generated category name
- `count` - Number of transactions in category
- `sum` - Total amount for category (Decimal precision)
- `mean` - Average transaction amount
- `std` - Standard deviation of amounts
- `min` - Minimum transaction amount
- `max` - Maximum transaction amount

**Features**:

- ✅ **AI-Generated Categories**: Based on transaction patterns and merchant similarity
- ✅ **Statistical Analysis**: Complete statistical summary per category
- ✅ **Spend Analysis**: Identifies major expense and revenue categories
- ✅ **Pattern Recognition**: Groups similar transactions automatically

**Note**: This sheet only appears when categorization is enabled and categories are successfully created.

---

### 6️⃣ **Active_Inactive_Accounts Sheet**

**Purpose**: Sophisticated account activity analysis using multiple criteria

**Columns**:

- `account_number` - Account identifier
- `status` - Account status ('Active' or 'Inactive')
- `total_transactions` - Total transaction count
- `recent_transactions_90_days` - Transactions in recent period
- `days_since_last_transaction` - Days since last activity
- `last_transaction_date` - Most recent transaction date
- `first_transaction_date` - Earliest transaction date
- `total_amount` - Total transaction value (Decimal precision)
- `avg_transaction_amount` - Average transaction amount

**Advanced Features**:

- ✅ **Smart Context Detection**: Automatically detects historical vs current data
- ✅ **Multi-Criteria Analysis**: Uses multiple factors for activity determination
- ✅ **Adaptive Thresholds**: Adjusts analysis parameters based on data period
- ✅ **Confidence Scoring**: Internal confidence metrics for classifications
- ✅ **Date Intelligence**: Uses appropriate reference dates for analysis

**Activity Determination Logic**:

- **Historical Data** (>30 days old): Uses data end date as reference
- **Current Data** (≤30 days old): Uses current date as reference
- **Multiple Criteria**: Transaction frequency, recent activity, consistency patterns
- **Adaptive Thresholds**: Shorter data periods use percentage-based thresholds

---

## 📄 Simple Report Structure

### **Simple Excel Report** (`*_simple.xlsx`)

**Purpose**: Streamlined report for executive presentations and quick insights

**Sheets**:

1. **Transaction_Data**: Clean transaction data without complex analytics
2. **Summary**: Essential metrics only

**Transaction_Data Columns**:

- Core transaction fields (account, date, description, amount, balance)
- Simplified formatting
- No advanced categorization

**Summary Metrics**:

- Total Transactions
- Total Credits
- Total Debits
- Net Position
- Unique Accounts (if applicable)
- Unique Merchants (if applicable)

---

## ⚙️ Technical Specifications

### 📊 **Data Processing**

**Decimal Precision**:

- All monetary values use Python `Decimal` type for precision
- Configured for 28 significant digits with ROUND_HALF_UP rounding
- Excel export converts to float with 2 decimal places for compatibility

**Date Formatting**:

- All dates standardized to `YYYY-MM-DD` format
- Time components included where relevant (`YYYY-MM-DD HH:MM:SS`)

**Large Dataset Handling**:

- Automatic sheet splitting for datasets >1M rows
- Configurable row limits per sheet (default: 1,000,000)
- Memory-efficient processing with chunking

### 🔧 **Excel Compatibility**

**Engine Support**:

- Primary: `xlsxwriter` (for large files)
- Fallback: `openpyxl` (for smaller files)
- Format: `.xlsx` (Excel 2007+)

**Features**:

- No VBA macros (pure data)
- Compatible with Excel 2007+, LibreOffice, Google Sheets
- Optimized for large file sizes
- No external dependencies in final file

---

## 🎯 **Business Use Cases**

### 💼 **Financial Analysis**

- **Cash Flow Analysis**: Use Executive_Summary and Account_Analysis
- **Vendor Analysis**: Focus on Top_Merchants sheet
- **Budget Planning**: Leverage Category_Analysis patterns
- **Account Management**: Use Active_Inactive_Accounts for portfolio management

### 📈 **Operational Insights**

- **Spend Analysis**: Category_Analysis + Top_Merchants
- **Account Health**: Account_Analysis + Active_Inactive_Accounts
- **Data Quality**: Raw_Data for completeness assessment
- **Trend Analysis**: Executive_Summary for high-level trends

### 🔍 **Compliance & Audit**

- **Transaction Completeness**: Raw_Data sheet with all processed data
- **Account Status**: Active_Inactive_Accounts for compliance reporting
- **Financial Position**: Executive_Summary for regulatory reporting
- **Audit Trail**: All sheets maintain data lineage and processing timestamps

---

## 📋 **Data Quality Indicators**

**Sheet Presence Logic**:

- `Raw_Data`: Always present
- `Executive_Summary`: Always present
- `Account_Analysis`: Present when account data available
- `Top_Merchants`: Present when merchant analysis successful
- `Category_Analysis`: Present when categorization enabled and successful
- `Active_Inactive_Accounts`: Present when account activity analysis performed

**Quality Indicators**:

- Missing sheets indicate processing limitations or data constraints
- Row counts in log files indicate processing success
- Category confidence scores indicate categorization quality
- Date range coverage indicates data completeness

---

## 🚀 **Performance Characteristics**

| Dataset Size | Excel File Size | Generation Time | Memory Usage |
|--------------|-----------------|-----------------|--------------|
| 2K records   | ~200KB          | <5 seconds      | ~150MB       |
| 50K records  | ~5MB            | ~15 seconds     | ~500MB       |
| 500K records | ~50MB           | ~60 seconds     | ~2GB         |
| 1M+ records  | ~100MB          | ~120 seconds    | ~4GB         |

**Optimization Features**:

- Automatic data type optimization
- Decimal-to-float conversion only at export
- Chunked processing for memory efficiency
- Configurable precision and rounding

---

## 🔧 **Customization Options**

**Configuration Settings** (in `config/settings.py`):

```python
# Decimal precision
DECIMAL_SETTINGS = {
    'precision': 28,  # Significant digits
    'rounding': 'ROUND_HALF_UP',  # Rounding method
    'decimal_places': 2,  # Export decimal places
}

# Export settings  
EXPORT_SETTINGS = {
    'excel_engine': 'xlsxwriter',  # Excel engine
    'max_rows_per_sheet': 1000000,  # Sheet size limit
}

# Analysis settings
ANALYSIS_SETTINGS = {
    'top_merchants_count': 15,  # Merchant limit
    'active_account_days': 90,  # Activity threshold
}
```

This documentation provides complete details about the Excel export functionality. For questions about specific sheets
or data interpretations, refer to the analysis logs generated during processing.
